<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cleaning Tracker</title>
</head>
<body>

  <h2>Cleaning Tracker</h2>
  
  <!-- Tasks -->
  <div id="tasks">
    <button onclick="recordClick('floor')">Floor Cleaned</button>
    <button onclick="recordClick('surfaces')">Surfaces Cleaned</button>
    <button onclick="recordClick('dishes')">Dishes Cleaned</button>
    <button onclick="recordClick('trash')">Trash Taken Out</button>
    <button onclick="recordClick('freeDay')">Free Day Selected</button>
  </div>

  <script>
    const apiUrl = 'https://api.github.com/repos/RahulKannan04/Cleaning Data/contents/data.json';
    const githubToken = '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';

    // Get user code from URL query (e.g., ?code=1234)
    const urlParams = new URLSearchParams(window.location.search);
    const userCode = urlParams.get('code');

    // Function to record a cleaning action
    function recordClick(task) {
      const timestamp = new Date().toLocaleString();
      const newRecord = { code: userCode, task: task, timestamp: timestamp };

      // Fetch the current content of the file from GitHub
      fetch(apiUrl, {
        headers: {
          Authorization: `token ${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}`,
          Accept: 'application/vnd.github.v3+json'
        }
      })
      .then(response => response.json())
      .then(data => {
        // Decode the base64 content of the file
        const fileContent = JSON.parse(atob(data.content));
        
        // Add new record
        fileContent.records.push(newRecord);

        // Update the file on GitHub with new content
        updateGitHubFile(fileContent, data.sha);
      })
      .catch(error => console.error('Error fetching file:', error));
    }

    // Function to update the file on GitHub
    function updateGitHubFile(content, sha) {
      fetch(apiUrl, {
        method: 'PUT',
        headers: {
          Authorization: `token ${githubToken}`,
          Accept: 'application/vnd.github.v3+json'
        },
        body: JSON.stringify({
          message: 'Updated data.json with new record',
          content: btoa(JSON.stringify(content, null, 2)), // Convert to base64
          sha: sha // Include the SHA of the existing file
        })
      })
      .then(response => response.json())
      .then(data => {
        alert('Data recorded successfully');
        console.log('File updated:', data);
      })
      .catch(error => console.error('Error updating file:', error));
    }
  </script>

</body>
</html>
